import{clone as m,flattenDeep as d}from"lodash";var h=function(e=[],t,r){let n={};return Array.isArray(t)?e.forEach(o=>{n[o[t[0]]]=r?Object.assign(o,m(r)):o[t[1]]}):e.forEach(o=>{n[o[t]]=r?Object.assign(o,m(r)):o}),n},E=function(e,t){function r(n){return function(o,i){var s=n?o[n]:o,c=n?i[n]:i;if(typeof s=="number"&&typeof c=="number")return s-c}}return e.sort(r(t))},D=function(e,t){function r(n){return function(o,i){var s=n?o[n]:o,c=n?i[n]:i;if(typeof s=="number"&&typeof c=="number")return c-s}}return e.sort(r(t))},F=(e,t)=>{let r=n=>n[t]?[n,n[t].map(r)]:n;return d(e.map(r))},K=(e,t)=>e.map(r=>{let n={};return t.forEach(o=>{n[o]=r[o]}),n});import g from"path";import a from"fs";var v=e=>{let t=g.resolve(process.cwd(),e);return a.readFileSync(t,{encoding:"utf-8"})},R=e=>{let t=g.resolve(process.cwd(),e),r=a.readFileSync(t,{encoding:"utf-8"});try{return JSON.parse(r)}catch{return{}}},f=e=>new Promise((t,r)=>{a.access(e,n=>{t(!n)})}),$=async(e,t,r)=>{if(await f(e))return console.log("\u26A0\uFE0F \u6587\u4EF6\u5DF2\u5B58\u5728\uFF1A",e);let o=e.split("/"),i=o[o.length-1],s=e.replace(RegExp(`${i}$`),"");await x(s,{basePath:r}),a.writeFileSync(e,t,"utf8")},x=async(e,t)=>{let{basePath:r=""}=t||{};RegExp(`^${r}`).test(e)||console.warn("\u4F20\u5165\u591A\u8DEF\u5F84\u4E0D\u662F\u4EE5",r,"\u5F00\u5934\uFF0C\u914D\u7F6E\u65E0\u6548\uFF01");let o=e.replace(r,"").replace(/^\//,"").split("/");for(;o.length;){let i=o.shift(),s=`${r}/${i}`,c=await f(s);try{c||a.mkdirSync(s)}catch(l){if(l&&l.message&&!l.message.includes("file already exists"))throw new Error(l)}finally{r=s}}},j=async(e,t,r)=>{if(await f(e))return console.log("\u26A0\uFE0F \u6587\u4EF6\u5DF2\u5B58\u5728\uFF1A",e);let o=e.split("/"),i=o[o.length-1],s=e.replace(RegExp(`${i}$`),"");return await x(s,{basePath:r}),new Promise((c,l)=>{let y=a.createReadStream(t.path),u=a.createWriteStream(e);y.pipe(u);let p=!1;u.on("error",T=>{p=!0,u.destroy(),l(T)}),u.on("finish",()=>{p||(c("finish"),u.close())})})};var O=e=>e.then(t=>[t]).catch(t=>[null,t]),P=(e,t=!0)=>{if(e.status==="fulfilled")return[e.value];if(t)throw new Error(e.reason);return[null,e.reason]},N=(e,t=!0)=>e.map(r=>P(r,t));export{h as arr2Dic,f as checkExist,x as createDir,j as createFile,F as flattenDeepByField,N as getAllSettledPromiseData,v as getProjectFile,R as getProjectJsonFile,O as getPromiseData,P as getSettledData,K as mapFields,E as sortAsc,D as sortDesc,$ as writeFile};
